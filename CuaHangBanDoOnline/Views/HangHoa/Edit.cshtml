@model CuaHangBanDoOnline.Models.HangHoa

<h2>Chỉnh sửa hàng hóa</h2>

<form asp-action="Edit" enctype="multipart/form-data">
    <input type="hidden" asp-for="MaHangHoa" />

    <div class="form-group">
        <label>Tên Hàng Hóa</label>
        <input asp-for="TenHangHoa" class="form-control" required />
    </div>

    <div class="form-group">
        <label>Giá</label>
        <input asp-for="GiaBan" type="number" class="form-control" required />
    </div>

    <div class="form-group">
        <label>Mô Tả</label>
        <textarea asp-for="MoTa" class="form-control"></textarea>
    </div>

    <div class="form-group">
        <label>Số lượng tồn</label>
        <input asp-for="SoLuongTon" type="number" class="form-control" />
    </div>

    <div class="form-group">
        <label>Hình Ảnh Hiện Tại</label><br />
        @if (!string.IsNullOrEmpty(Model.Hinh))
        {
            <img src="@Model.Hinh" alt="Hình ảnh sản phẩm" width="150" height="150" />
        }
        else
        {
            <p>Chưa có hình ảnh</p>
        }
    </div>

    <div class="form-group">
        <label>Chọn Hình Ảnh Mới</label>
        <input type="file" name="HinhAnh" class="form-control-file" />
    </div>

    <div class="form-group">
        <label>Danh Mục Hiện Tại</label>
        <ul id="danhMucList">
            @if (ViewBag.DanhMucHienTai != null && ViewBag.DanhMucHienTai.Count > 0)
            {
                @foreach (var danhMuc in ViewBag.DanhMucHienTai)
                {
                    <li>@danhMuc</li>
                }
            }
            else
            {
                <li>Chưa có danh mục</li>
            }
        </ul>
    </div>

    <div class="form-group">
        <label>Thêm Danh Mục</label>
        <select id="maDanhMuc" class="form-control">
            @foreach (var danhMuc in ViewBag.DanhMucs)
            {
                <option value="@danhMuc.Value">@danhMuc.Text</option>
            }
        </select>
        <button type="button" class="btn btn-primary mt-2" id="btnThemDanhMuc">Thêm</button>
    </div>

    <button type="submit" class="btn btn-success">Cập nhật</button>
    <a asp-action="Index" class="btn btn-secondary">Hủy</a>
</form>

<script>
    document.getElementById("btnThemDanhMuc").addEventListener("click", function () {
        var maDanhMuc = document.getElementById("maDanhMuc").value;
        var maHangHoa = @Model.MaHangHoa;

        fetch('/HangHoa/Themdanhmuc', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: `maHangHoa=${maHangHoa}&maDanhMuc=${maDanhMuc}`
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    var danhMucList = document.getElementById("danhMucList");
                    var newDanhMuc = document.createElement("li");
                    newDanhMuc.textContent = data.tenDanhMuc;
                    danhMucList.appendChild(newDanhMuc);
                } else {
                    alert("Lỗi khi thêm danh mục!");
                }
            });
    });
</script>
